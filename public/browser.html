<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Reconhecimento no Navegador</title>
</head>
<body>
  <script>
    let recognition;

    async function playAudioThenRecognize() {
      const audio = new Audio('audio.wav');
      return new Promise((resolve, reject) => {
        audio.onended = () => {
          resolve();
        };
        audio.onerror = (e) => {
          reject(e);
        };
        audio.play();
      });
    }

    window.startRecognition = async () => {
      try {
        await playAudioThenRecognize();

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = 'pt-BR';
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onresult = (event) => {
          const transcript = Array.from(event.results)
            .map(result => result[0].transcript)
            .join('')
            .trim();
          console.log('ðŸ“ Texto transcrito:', transcript);
          window.onTranscription(transcript);
        };

        recognition.onerror = (event) => {
          console.error('âŒ Erro no reconhecimento:', event.error);
          window.onTranscription('');
        };

        recognition.start();
        console.log('ðŸŽ¤ Iniciando reconhecimento...');
      } catch (err) {
        console.error('Erro ao tocar Ã¡udio ou iniciar reconhecimento:', err);
        window.onTranscription('');
      }
    };

    window.stopRecognition = () => {
      if (recognition) {
        recognition.stop();
        console.log('ðŸ›‘ Reconhecimento interrompido.');
      }
    };
  </script>
</body>
</html>
